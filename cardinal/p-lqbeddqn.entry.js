import{r as t,h as e,g as o}from"./p-2eb42df6.js";import"./p-7745c6f7.js";import"./p-5c62ed62.js";import{T as i}from"./p-43fec8b7.js";import{C as r}from"./p-f49df5a7.js";const s="@event:";class n{static _prepareRoutesTree(t,e){let o=function(t){let i={};return t.forEach(t=>{let r=t.name.replace(/(\s+|-)/g,"").toLowerCase();if(!i[r]){let o=t.path;switch(e){case"browser":case"query":o=t.path;break;case"hash":o="/#"+t.path}i[r]={path:o}}if("object"==typeof t.children&&Array.isArray(t.children.items))i[r].children={type:"known",items:o(t.children.items)};else if("string"==typeof t.children&&0===t.children.indexOf(s)){let e=t.children.substring(s.length);i[r].children={type:"event",event:e}}}),i};return o(t)}static _prepareConfiguration(t,e){let o={};o.baseUrl=e;let i=e+t.basePagesUrl;if(t.modals&&(o.modals={},Object.keys(t.modals).length))for(let s in t.modals)o.modals[s]=i+t.modals[s];if(!t.menu||!t.menu.defaultMenuConfig)throw new Error("Default menu configuration is missing");let r=t.menu.defaultMenuConfig;t.profile&&(o.profile=t.profile);let l=function(t){for(let e=0;e<t.length;e++)t[e].children&&t[e].children.items?l(t[e].children.items):void 0!==t[e].indexed&&"false"===t[e].indexed.toString()&&t.splice(e,1);return t},a=function(t,e){return t.forEach(t=>{if(!t.path){let e=t.name.toLowerCase().toLowerCase().replace(/\s+/g,"-");e=e.replace(/[:\/]/g,""),t.path=e}if(e?t.path=e+"/"+t.path:0!==t.path.indexOf("/")&&(t.path="/"+t.path),t.children)t.type="abstract",t.icon||(t.icon=r.icon);else{for(let e in r)t.hasOwnProperty(e)||(t[e]=r[e]);if("psk-page-loader"===t.component)if(t.componentProps||(t.componentProps={}),Object.assign(t.componentProps,t.options),t.pageSrc)t.componentProps.pageUrl=t.pageSrc.startsWith("http")?t.pageSrc:i+t.pageSrc;else{let o=t.name.replace(/[:.!?]/g,"").replace(/\s/g,"-").toLowerCase(),r="";e&&(r=e.replace(/^\//,"")),t.componentProps.pageUrl=i+r+"/"+o+".html"}}if("object"==typeof t.children&&Array.isArray(t.children))t.children={type:"known",items:JSON.parse(JSON.stringify(t.children))},a(t.children.items,t.path);else if("string"==typeof t.children&&0==t.children.indexOf(s)){let e=t.children.substring(s.length);t.children={type:"event",event:e},t.component="psk-ssapp-loader"}}),t};o.routes=a(t.menu.pages),o.historyType="browser";let c=t.menu.defaultMenuConfig.historyType;if("hash"!==c&&"query"!==c||(o.historyType=c),"query"===c){let e="?";t.menu.defaultMenuConfig.pagePrefix&&(e=t.menu.defaultMenuConfig.pagePrefix);let i=function(t){t.forEach(t=>{let o=t.path;0===o.indexOf("/")&&(o=o.substr(1)),t.path=`${e}${o}`,t.children&&i(t.children.items)})};i(o.routes)}let f=JSON.parse(JSON.stringify(o.routes));return o.menu=l(f),o.keywords=function(t){let e=[];return function t(o){o.forEach(o=>{Object.prototype.hasOwnProperty.call(o,"keyword")&&(e[o.keyword]=o.path),"object"==typeof o.children&&Array.isArray(o.children.items)&&t(o.children.items)})}(t),e}(f),o.pagesHierarchy=n._prepareRoutesTree(o.routes,c),o}}const l="/app-config.json";class a{constructor(t){this.configIsLoaded=!1,this.pendingRequests=[],this._getAppConfiguration(l,(t,e)=>{let o;for(o=window&&window.location&&window.location.origin?window.location.origin:e.baseUrl,this.configuration=n._prepareConfiguration(e,o),this.configIsLoaded=!0;this.pendingRequests.length;){let t=this.pendingRequests.pop();if(!this.configuration[t.configName])throw new Error(`Config ${t.configName} was not provided`);t.callback(null,this.configuration[t.configName])}}),t.addEventListener("needRoutes",this._provideConfig("routes")),t.addEventListener("needMenuItems",this._provideConfig("menu")),t.addEventListener("getUserInfo",this._provideConfig("profile")),t.addEventListener("getHistoryType",this._provideConfig("historyType")),t.addEventListener("getModals",this._provideConfig("modals")),t.addEventListener("getKeywords",this._provideConfig("keywords")),t.addEventListener("validateUrl",t=>{t.stopImmediatePropagation();let{sourceUrl:e,callback:o}=t.detail;o&&"function"==typeof o?this._parseSourceUrl(e,o):console.error("Callback was not properly provided!")})}_provideConfig(t){return e=>{e.stopImmediatePropagation();let o=e.detail;if(o&&"function"==typeof o)if(this.configIsLoaded){if(!this.configuration[t])throw new Error(`Config ${t} was not provided`);o(void 0,this.configuration[t])}else this.pendingRequests.push({configName:t,callback:o})}}_parseSourceUrl(t,e){let o=(t=t.replace(/(\s+|-)/g,"").toLowerCase()).split("/"),i=this.configuration.pagesHierarchy;for(let r=0;r<o.length;r++){let s=o[r];const n=Object.keys(i).find((function(t){return-1!==i[t].path.toLowerCase().indexOf(s)}));let l,a,c=void 0!==i[n];if(!i[s]&&!c){e(`${t} is not a valid path in the application!`);break}if("object"!=typeof(l=c?i[n].children:i[s].children)||"object"!=typeof l.items||r===o.length)return e(void 0,a=c?i[n].path:i[s].path);i=l.items}}_getAppConfiguration(t,e){let o=new XMLHttpRequest;o.open("GET",t),o.onload=()=>{if(200!=o.status)e(new Error(o.status.code));else{let t=JSON.parse(o.responseText);e(null,t)}},o.onerror=()=>{e(new Error("An error occurred"))},o.send()}}const c=class{constructor(e){t(this,e),this.mobileLayout=!1,this.componentCode="",this.hasSlot=!1}__createLoader(){let t="";for(let o=1;o<=12;o++)t+=`<div class="sk-circle${o} sk-circle"></div>`;let e=document.createElement("div");return e.className="app-loader",e.innerHTML=`<div class='sk-fading-circle'>${t}</div>`,e}connectedCallback(){this.disconnected=!1}disconnectedCallback(){this.disconnected=!0}componentWillLoad(){this.host.parentElement&&(this.htmlLoader=this.__createLoader(),this.host.parentElement.appendChild(this.htmlLoader));let t=this.host.innerHTML;if((t=t.replace(/\s/g,"")).length&&(this.hasSlot=!0),"string"==typeof this.controller)return new Promise((t,e)=>{r.getController(this.controller).then(e=>{if(this.disconnected)return t();new e(this.host),t()}).catch(e)});new a(this.host)}componentDidLoad(){this.htmlLoader&&this.htmlLoader.parentNode&&this.htmlLoader.parentNode.removeChild(this.htmlLoader)}render(){return e(this.hasSlot?"slot":"psk-default-renderer",null)}get host(){return o(this)}};!function(t,e,o,i){var r,s=arguments.length,n=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,o,i);else for(var l=t.length-1;l>=0;l--)(r=t[l])&&(n=(s<3?r(n):s>3?r(e,o,n):r(e,o))||n);s>3&&n&&Object.defineProperty(e,o,n)}([i({isMandatory:!1,description:["This property is a string that will permit the developer to choose his own controller.","If no controller is provided, a default controller will be passed to the component","It is recommended that each app to extend the provided default controller and adapt it to the application needs"],propertyType:"string",defaultValue:"null"})],c.prototype,"controller",void 0);export{c as psk_app_root};